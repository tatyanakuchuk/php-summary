# Регистрация на сайте

_Создание аккаунта - это заполнение формы, где пользователь указывает свои идентификаторы: логин или email, а также способ подтверждения - пароль._

**Обязательные поля регистрации:**  
	1. **Логин** – это имя пользователя на сайте.  Логин должен быть уникальным.  
	2. **Пароль** – это секретная комбинация, известная только пользователю. Пароль можно генерировать за пользователя и отправлять его письмом.  Это секретная фраза - способ пользователю доказать, что он тот кем он представляется.  
	3. **E-mail** - адрес электронной почты пользователя тоже должен быть уникальным. Он понадобится для восстановления пароля.   

1. [Правильное хранение паролей](#1)
2. [Что такое отпечаток пароля?](#2)
3. [Свойства хэшируюших функций](#3)
4. [Хранение и проверка паролей](#4)
5. [Проверка пароля пользователя](#5)

<a name="1"><h2>Правильное хранение паролей</h2></a>

Логины и пароли пользователей хранятся на сервере   и используются для аутентификации.  
Пароли нельзя хранить в открытом виде, потому что при   краже информации из БД данные всех пользователей   становятся скомпрометированными.  
**Вместо паролей следует хранить их отпечатки - хэши.**

<a name="2"><h2>Что такое отпечаток пароля?</h2></a>

**Отпечаток (хэш)** – это результат работы функции хэширования,   которая вернёт для любого значения строку фиксированной длины.  
Провести обратную операцию (получить из отпечатка оригинальную   строку) невозможно.
Хэш (отпечаток, фингерпринт) — последовательность символов, однозначно идентифицирующая оригинал.

<a name="3"><h2>Свойства хэшируюших функций</h2></a>

- Из отпечатка невозможно получить оригинал;
- Размер отпечатка всегда фиксирован;
- Разные данные никогда не вернут один отпечаток;
- Чаше всего используются для паролей и проверки  данных на целостность.

<a name="4"><h2>Хранение и проверка паролей</h2></a>

1. Получить хэш от пароля пользователя и сохранить его в БД;
2. При аутентификации запросить пароль;
3. Получить хэш от полученного пароля и сравнить его с сохраненным хэшом в п.1;
4. Если две строки совпадают, значит пароль введен правильно.

```php
$passwordHash = password_hash('secret-password', PASSWORD_DEFAULT); // получает хэш пароля

if (password_verify('bad-password', $passwordHash)) { //сравнивает введенный пароль с хэшом
	// корректный пароль
} 
else {
	// неверный пароль
}
```

<a name="5"><h2>Проверка пароля пользователя</h2></a>

1. Найти пользователя (в массиве или из базы данных)  по переданному логину/email;
2. Захешировать переданный пароль;
3. Сравнить сохраненный хэш пользователя с хэшем  из п.2;
4. Открыть сессию, если хэши совпадают.

Общая схема:
![Аутентификация и авторизация](../master/img/Screenshot_7.png)

<a name="6"><h2>Восстановление пароля</h2></a>
_Возможность пользователю восстановить забытый пароль, используя свой e-mail._

**Как работает восстановление пароля:**
1. Юзер указывает свой email
2. Отправляем ему ссылку со   специальным кодом
3. Юзер переходит по ссылке на страницу с формой для ввода нового пароля
4. Новый пароль хэшируется и сохраняется для юзера
5. Юзер логинится на сайт с новым паролем

![Восстановление пароля](../master/img/Screenshot_9.png)


