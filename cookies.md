# Cookies

_Небольшая порция текстовой информации, который сервер передает браузеру. Браузер будет хранить эту инф-цию и передавать её обратно серверу с каждым запросом._

1. [Свойства cookies](#1)
2. [Где хранятся куки?](#2)
3. [Из чего состоят куки?](#3)
4. [Заголовок ответа для установки куки](#4)
5. [Заголовок запроса для передачи куки](#5)
6. [Где хранятся куки?](#6)
7. [Когда удаляются куки?](#7)
8. [Работа с куками в PHP](#8)
9. [Чтение cookies](#9)
10. [Как удалить cookies?](#10)
11. [Безопасность при работе с cookies](#11)
12. [Достоинства и недостатки cookies](#12)

<a name="1"><h2>Свойства cookies:</h2></a>
1. Поддерживаются всеми браузерамию
2. Представляют собой кусок текста
3. Куки, установленные пользователем,передаются обратно на сайт в заголовках при каждом запросе
4. Браузер сам определяет какому сайту какие куки отправить
5. Имеют "срок годности"

<a name="2"><h2>Где хранятся куки?</h2></a>

**Первое посещение = установка куки:**
1. &#x21e8; Браузер отсылает HTTP запрос на сервер
2. &#x21e6; Чтобы "запомнить" пользователя сервер отсылает специальный заголовок ответа "cookies" с данными

**Следующее посещуние - получение куки**
1. &#x21e8; Браузер отсылает HTTP запрос вместе с куками на сервер
2. &#x21e6; Сервер "узнает" пользователя и возвращает ему релевантную инф-цию


<a name="3"><h2>Из чего состоят куки?</h2></a>

<a name="4"><h3>Заголовок ответа для установки куки:</h3></a>

```php
Set-Cookie:
NAME = VALUE; //название куки
expires = DATE; // время жизни куки
path = PATH; // путь на сайте, для которого будет доступна кука
//например, для работы на всем сайте указывается слэш: "/"
domain = DOMAIN_NAME; //поддомен, для которого устанавливается кука
```

**Установка куки для разных частей сайта:** при создании куки возможно указать путь на сайте, где она будет доступна.

**Максимальный срок жизни куки:** при создании куки обязательно указывается её время жизни. Максимальная дата - 19 января 2038 года.

<a name="5"><h3>Заголовок запроса для передачи куки:</h3></a>

```php
Cookie: NAME1 = STRING1; NAME2 = STRING2; ...
```

- В одном заголовке передаются все куки для этого сайта
- Это строки вида "ключ-значение"
- Разделяются точкой с запятой

<a name="6"><h2>Где хранятся куки?</h2></a>

_Все куки хранятся в отдельном файле, который находится в папке с конфигурацией браузера._

<a name="7"><h2>Когда удаляются куки?</h2></a>

- Истек срок их жизни
- Очистка истории браузера  
Либо их можно удалить в настройках браузера.

<a name="8"><h2>Работа с куками в PHP</h2></a>

Написать PHP сценарий, который будет считать количество посещений пользователем страницы и выводить этот счетчик на экран.  
Для хранения счетчика между посещениями страницы будут использоваться куки.

Нам понадобятся следующие функции:  
- _strtotime($date)_ - переводит дату из человеческого описания в формат для cookies
- _setcookie($name, $value, $expire, $path)_ - устанавливает куку и все параметры, отсылает заголовок

```php
$name = "visit_count";
$value = 1;
$expire = "Mon, 25-Jan-2027 10:00:00 GMT";
$path = "";

setcookie($name, $value, $expire, $path);
```

<a name="9"><h2>Чтение cookies</h2></a>

```php
if(isset($_COOKIES["visit_count"])) {
	print($_COOKIES["visit_count"]);
}
```

<a name="10"><h2>Как удалить cookies?</h2></a>

_Нужно очистить массив $_COOKIES и послать заголовок, который удалит куку из браузера._  

```php
if(isset($_COOKIES["visit_count"])) {
	unset($_COOKIES["visit_count"]);

	setcookie("visit_count", "", time() - 3600, "/");
	// time() - 3600 - установка даты из прошлого
}
```

<a name="11"><h2>Безопасность при работе с cookies</h2><a>

В куках может содержаться конфиденциальная информация,  а значит они могут стать мишенью злоумышленников

```php
bool setcookie ( string $name [, string $value = "" [, int $expire = 0 [, string $path = "" [,   string $domain = "" [, bool $secure = FALSE [, bool $httponly = FALSE ]]]]]] )
```

Как повысить безопасность: 
- **bool $secure = FALSE** - передача кук только по протоколу https 
- **bool $httponly = FALSE** - запрет на использование из JavaScript (XSS уязвимость) 

<a name="12"><h2>Достоинства и недостатки cookies</h2><a>

**Достоинства:**
- Самый универсальный и стандартный   способ хранения состояния
- Поддерживается всеми браузерами
- Отличная поддержка в PHP

**Недостатки:**
- Ограничения по формату и   объему данных
- Зависят от заголовков
- Проблемы с безопасностью




